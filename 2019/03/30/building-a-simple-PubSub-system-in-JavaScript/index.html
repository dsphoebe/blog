<!Doctype html>
<html>
  <head>
  <meta charset="utf-8">
  
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>è¯‘æ–‡ï¼šç”¨ EventTarget é€»è¾‘æ¥å®ç° PubSub | FE NOTEBOOK ğŸš€</title>
  
    <link rel="icon" href="/images/favico.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/style/gitalk.css">
  <link rel="stylesheet" href="/style/style.css">
  <script src="/js/gitalk.min.js"></script>
</head>
  <body>
    <header class="header">
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">é¦–é¡µ</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">å½’æ¡£</a>
        </li>
      
    </ul>
  </nav>
  <h1 class="pc">FE NOTEBOOK ğŸš€</h1>
  <h1 class="mobile"><a href="/">FE NOTEBOOK ğŸš€</a></h1>
  <em>ã€Œ å­¦æµ·æ— æ¶¯ï¼Œæ²¡ç©ºæ’©å¦¹ï¼ã€</em>
</header>
    <main class="main">
      <article class="post">
  <div class="post-title">
    <h2 class="title">è¯‘æ–‡ï¼šç”¨ EventTarget é€»è¾‘æ¥å®ç° PubSub</h2>
  </div>
  <div class="post-meta">
    <span class="post-time">2019-03-30 01:27:42</span>
    <span class="post-tags">
      
    </span>
    
  </div>
  <div class="post-content">
    <blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://paul.kinlan.me/building-a-pubsub-api-in-javascript/" target="_blank" rel="noopener">Building a simple PubSub system in JavaScript</a></p>
</blockquote>
<p>æˆ‘æœ€è¿‘åœ¨å¼€å‘ä¸€ä¸ª Web push é¡¹ç›®ï¼Œéœ€è¦è®© UI å“åº”åº”ç”¨ç¨‹åºçº§åˆ«çš„äº‹ä»¶ã€‚<br>å› ä¸ºæœ‰å‡ ä¸ªç»„ä»¶éœ€è¦æ¥è‡ªç³»ç»Ÿçš„ä¿¡æ¯ï¼Œä½†æ˜¯å®ƒä»¬åˆä¸äº’ç›¸ä¾èµ–ã€‚<br>æˆ‘æƒ³è®©å®ƒä»¬èƒ½ç‹¬ç«‹äºâ€ä¸šåŠ¡é€»è¾‘â€æ¥ç»´æŠ¤è‡ªå·±ã€‚</p>
<p>æˆ‘åœ¨ç½‘ä¸Šçœ‹äº†å¾ˆå¤šåº“ï¼Œä½†æ˜¯æˆ‘æ˜¯ä¸€ä¸ªä¸¥é‡çš„ <a href="https://baike.baidu.com/item/NIH%E7%BB%BC%E5%90%88%E7%97%87" target="_blank" rel="noopener">NIH ç»¼åˆç—‡</a>æ‚£è€…ï¼Œ<br>æœ€åæˆ‘å†³å®šå†™ä¸€ä¸ªç®€å•çš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å®Œæˆæˆ‘çš„éœ€æ±‚ã€‚</p>
<p>æˆ‘åœ¨è€ƒè™‘æˆ‘æ˜¯å¦åº”è¯¥ä½¿ç”¨ DOM äº‹ä»¶ã€‚å®ƒå·²ç»æä¾›ç»™å¼€å‘è€…ä¸€ä¸ªåŸºæœ¬å‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼šç”¨ addEventListener æ¥ç›‘å¬äº‹ä»¶ï¼Œç„¶åè§¦å‘äº‹ä»¶ã€‚<br>ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼šäº‹ä»¶æ˜¯å¿…é¡»ç»‘å®šåˆ° DOM å…ƒç´ æˆ–è€… window ä¸Šã€‚JavaScript æ²¡æœ‰æä¾›ç»™ä½ å…¶ä»–ç»§æ‰¿è‡ª EventTarget çš„æ¨¡å‹ã€‚</p>
<p>æ€è€ƒï¼šå°† EventTarget ä½œä¸ºä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¸ç”¨åˆ›å»ºè‡ªå®šä¹‰ PubSub ç³»ç»Ÿã€‚ğŸ¤”</p>
<p>è·Ÿç€è¿™ä¸ªæ€è·¯ï¼Œä¸€ä¸ªåˆç•¥å¤§è‡´çš„ä»£ç å¦‚ä¸‹ï¼ˆpsï¼šå…ˆä¸è€ƒè™‘ä»£ç çš„å¯æ‰§è¡Œæ€§ï¼‰</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* When a user added, do something useful like update UI */</span></span><br><span class="line">EventManager.subsribe(<span class="string">'useradd'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(user);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The UI submits the data, lets publish the event. */</span></span><br><span class="line">form.onsubmit(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// do something with user fields.</span></span><br><span class="line">    </span><br><span class="line">    EventManager.publish(<span class="string">'useradd'</span>, user);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Redux å’Œå…¶ä»–ä¸€äº›ç³»ç»Ÿä¹Ÿæ˜¯ç”¨è¿™ä¸ªæ€è·¯æ¥åšçš„ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç† stateã€‚<br>æˆ‘å¹¶ä¸æ˜¯éœ€è¦ä¸€ä¸ªçŠ¶æ€éš”ç¦»çš„æ¨¡å‹çš„ stateã€‚</p>
<p>æˆ‘è‡ªå·±å®ç°ä¸€ä¸ªï¼Œå¯¹æˆ‘æ¥è¯´å®ƒå®ç°èµ·æ¥å¾ˆç®€å•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> EventManager = <span class="keyword">new</span> (</span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> events = &#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.publish = <span class="function"><span class="keyword">function</span>(<span class="params">name, data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> handlers = events[name];</span><br><span class="line">            <span class="keyword">if</span> (!!handlers === <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line">            handlers.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">                handlers.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">                    handler.call(<span class="keyword">this</span>, data);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.subscribe = <span class="function"><span class="keyword">function</span>(<span class="params">name, handler</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> handlers = events[name];</span><br><span class="line">            <span class="keyword">if</span> (!!handlers === <span class="literal">false</span>) &#123;</span><br><span class="line">                handlers = events[name] = [];</span><br><span class="line">            &#125;</span><br><span class="line">            handlers.push(handler);</span><br><span class="line">        &#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">this</span>.unsubscribe = <span class="function"><span class="keyword">function</span>(<span class="params">name, handler</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> handlers = events[name];</span><br><span class="line">            <span class="keyword">if</span> (!!handers === <span class="literal">false</span>) <span class="keyword">return</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> handlerIdx = handlers.indexOf(handler);</span><br><span class="line">            handlers.splice(handlerIdx);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>çœ‹èµ·æ¥ä¼šæœ‰å¾ˆå¤š bugï¼Œä½†æˆ‘å–œæ¬¢ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œæˆ‘å·²ç» push åˆ° <a href="https://github.com/PaulKinlan/EventManager" target="_blank" rel="noopener">GitHub</a> ä¸Šäº†ã€‚</p>

  </div>
  
</article>
    </main>
    <footer>
  <p>&copy; 2019 code.dsphoebe.com <wbr> <a href="http://www.miitbeian.gov.cn/">äº¬ICPå¤‡15048606å·-1</a></p>
</footer>
  </body>
</html>
